# 【Redis安全基线】- 在生产环境中需要注意的安全事项

Redis是一个高性能的键值存储数据库，但在实际使用中，如果没有适当的安全措施，可能会面临严重的安全风险。本文将介绍几种加强Redis安全性的最佳实践，包括防止弱口令、限制危险命令、修改默认端口等。

### 1. Redis弱口令

**场景说明：** Redis默认配置较为简单，若未设置强密码，可能导致被攻击者轻易访问。强密码可有效防止暴力破解。

**操作步骤：**
- 打开Redis配置文件`redis.conf`，找到`requirepass`配置项，去掉前面的`#`号，并修改为指定的强密码。密码应符合以下复杂性要求：

1. 长度8位以上
2. 包含以下四类字符中的三类字符:
   - 英文大写字母 (A 到 Z)
   - 英文小写字母 (a 到 z)
   - 10个基本数字 (0 到 9)
   - 非字母字符 (例如 !、$、#、%、@、^、&)
3. 避免使用已公开的弱口令，如：abcd.1234、admin@123等
4. - 修改后保存文件，并重启Redis服务以使设置生效。

**解释：** 设置强密码能够有效抵御暴力破解攻击，提高Redis实例的安全性。

### 2. 禁用或者重命名危险命令

**场景说明：** Redis中的某些命令（如`FLUSHALL`、`FLUSHDB`、`KEYS`等）可能被恶意用户滥用，从而导致数据丢失或泄露。

**操作步骤：**
- 修改Redis配置文件`redis.conf`，添加以下命令以重命名或禁用危险命令：

```txt
rename-command FLUSHALL ""
rename-command FLUSHDB ""
rename-command CONFIG ""
rename-command KEYS ""
rename-command SHUTDOWN ""
rename-command DEL ""
rename-command EVAL ""
```

**解释：** 通过禁用或重命名这些危险命令，减少了潜在的攻击面，降低了因错误操作造成的数据风险。

### 3. 修改默认6379端口

**场景说明：** Redis默认监听6379端口，广为人知，容易成为攻击目标。

**操作步骤：**

- 编辑Redis配置文件`redis.conf`，找到包含`port`的行，将默认的6379修改为一个自定义的端口号，例如：

  ```
  port 6380
  ```
  
- 修改后保存文件，并重启Redis服务。

**解释：** 修改默认端口可以降低被初级扫描和攻击的风险，增加系统的安全性。

### 4. 禁止监听在公网

**场景说明：** Redis如果监听在`0.0.0.0`，可能导致服务对外或内网横向渗透风险，容易被黑客利用。

**操作步骤：**

- 在Redis配置文件`redis.conf`中，将`bind`设置为`127.0.0.1`或特定的内网IP，例如：

  ```
  bind 127.0.0.1
  ```
  
- 修改后保存文件，并重启Redis服务。

**解释：** 通过限制Redis只在本地或特定IP上监听，减少了未授权外部访问的可能性。

### 5. 禁止使用root用户启动

**场景说明：** 使用root用户运行网络服务存在一定风险，可能导致安全漏洞的利用。

**操作步骤：**

- 创建一个

  ```
  redis
  ```

  用户并使用该用户启动Redis服务：

  ```
  useradd -s /sbin/nologin -M redis
  sudo -u redis /<redis-server-path>/redis-server /<configpath>/redis.conf > /dev/null 2>&1
  ```

**解释：** 通过以非root用户身份运行Redis，可以降低潜在的安全风险，避免攻击者利用root权限进行恶意操作。

### 6. 限制redis配置文件访问权限

**场景说明：** Redis密码明文存储在配置文件中，限制不相关用户访问该文件非常必要。

**操作步骤：**

- 修改Redis配置文件权限为600，确保只有

  ```
  redis
  ```

  用户可以访问：

  ```
  chmod 600 /<filepath>/redis.conf
  ```

**解释：** 限制配置文件的访问权限，可以防止敏感信息泄露，提高系统的安全性。

### 7. 打开保护模式

**场景说明：** Redis默认开启保护模式，可以防止未授权访问。

**操作步骤：**

- 在Redis配置文件

  ```
  redis.conf
  ```

  中确保以下设置为开启：

  ```
  protected-mode yes
  ```

**解释：** 当Redis未配置`bind`和`requirepass`时，开启保护模式将限制其只能被本地访问，增加安全性。

### 8. 版本安全漏洞

**场景说明：** 某些旧版本的Redis存在已知的安全漏洞，可能导致系统被攻击。

**漏洞列表：**

1. Redis 2.8.1之前和3.0.2之前的版本存在字节码命令执行漏洞【详细信息】(https://avd.aliyun.com/detail?id=AVD-2015-4335)。
2. Redis 4.x至5.0.5版本存在主从复制命令执行漏洞。
3. Redis 3.2.0至3.2.4版本存在缓冲区溢出漏洞，可导致任意代码执行【详细信息】(https://avd.aliyun.com/detail?id=AVD-2016-8339)。

**建议：** 定期检查Redis版本，及时升级到最新的稳定版本，以确保系统安全。